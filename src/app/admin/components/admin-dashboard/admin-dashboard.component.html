<div class="admin-layout">
  <!-- Sidebar -->
  <aside class="admin-sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <div class="admin-logo">
        <div class="logo-icon">üè†</div>
        <span class="logo-text" *ngIf="!sidebarCollapsed">Makaan Admin</span>
      </div>
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="admin-profile" *ngIf="currentAdmin">
      <div class="profile-avatar">
        <span>{{ currentAdmin.displayName?.charAt(0) || 'A' }}</span>
      </div>
      <div class="profile-info" *ngIf="!sidebarCollapsed">
        <h4>{{ currentAdmin.displayName || 'Admin' }}</h4>
        <p>{{ currentAdmin.email }}</p>
      </div>
    </div>

    <nav class="sidebar-nav">
      <ul>
        <li [class.active]="activeMenuItem === 'dashboard'">
          <a href="#" (click)="setActiveMenuItem('dashboard'); $event.preventDefault()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span *ngIf="!sidebarCollapsed">Dashboard</span>
          </a>
        </li>
        <li [class.active]="activeMenuItem === 'users'">
          <a href="#" (click)="setActiveMenuItem('users'); $event.preventDefault()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 21V19A4 4 0 0 0 13 15H5A4 4 0 0 0 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M23 21V19A4 4 0 0 0 16 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 3.13A4 4 0 0 1 16 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span *ngIf="!sidebarCollapsed">Users</span>
          </a>
        </li>
        <li [class.active]="activeMenuItem === 'database'">
          <a href="#" (click)="setActiveMenuItem('database'); $event.preventDefault()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <ellipse cx="12" cy="5" rx="9" ry="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12C21 13.66 16.97 15 12 15S3 13.66 3 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 5V19C3 20.66 7.03 22 12 22S21 20.66 21 19V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span *ngIf="!sidebarCollapsed">Database</span>
          </a>
        </li>
      </ul>
    </nav>

    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span *ngIf="!sidebarCollapsed">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="admin-main">
    <!-- Header -->
    <header class="admin-header">
      <div class="header-left">
        <h1>{{ activeMenuItem === 'dashboard' ? 'Dashboard' : activeMenuItem === 'users' ? 'User Management' : 'Database Overview' }}</h1>
      </div>
      <div class="header-right">
        <div class="search-box" *ngIf="activeMenuItem === 'users'">
          <input 
            type="text" 
            placeholder="Search users..." 
            [(ngModel)]="searchTerm"
            (input)="filterUsers()"
            class="search-input"
          >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <button class="generate-report-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6A2 2 0 0 0 4 4V20A2 2 0 0 0 6 22H18A2 2 0 0 0 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Generate Report
        </button>
      </div>
    </header>

    <!-- Dashboard Content -->
    <div class="admin-content" *ngIf="activeMenuItem === 'dashboard'">
      <!-- Stats Cards -->
      <div class="stats-grid" *ngIf="adminStats">
        <div class="stat-card primary">
          <div class="stat-icon">üë•</div>
          <div class="stat-content">
            <h3>{{ adminStats.totalUsers }}</h3>
            <p>Total Users</p>
          </div>
        </div>
        <div class="stat-card success">
          <div class="stat-icon">üõí</div>
          <div class="stat-content">
            <h3>{{ adminStats.totalCustomers }}</h3>
            <p>Customers</p>
          </div>
        </div>
        <div class="stat-card warning">
          <div class="stat-icon">üè†</div>
          <div class="stat-content">
            <h3>{{ adminStats.totalSellers }}</h3>
            <p>Sellers</p>
          </div>
        </div>
        <div class="stat-card danger">
          <div class="stat-icon">‚ö°</div>
          <div class="stat-content">
            <h3>{{ adminStats.totalAdmins }}</h3>
            <p>Admins</p>
          </div>
        </div>
      </div>

      <!-- Recent Users -->
      <div class="dashboard-section">
        <div class="section-header">
          <h2>Recent Users</h2>
          <button class="view-all-btn" (click)="setActiveMenuItem('users')">View All</button>
        </div>
        <div class="recent-users-list" *ngIf="adminStats?.recentUsers">
          <div class="user-item" *ngFor="let user of adminStats?.recentUsers">
            <div class="user-avatar">
              <span>{{ user.displayName?.charAt(0) || 'U' }}</span>
            </div>
            <div class="user-info">
              <h4>{{ user.displayName || 'Unknown User' }}</h4>
              <p>{{ user.email }}</p>
            </div>
            <div class="user-role">
              <span class="role-badge" [style.background-color]="getRoleColor(user.role)">
                {{ user.role }}
              </span>
            </div>
            <div class="user-date">
              <span>{{ formatDate(user.createdAt) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Management Content -->
    <div class="admin-content" *ngIf="activeMenuItem === 'users'">
      <!-- Filters -->
      <div class="filters-section">
        <div class="filter-group">
          <label>Filter by Role:</label>
          <select [(ngModel)]="selectedRole" (change)="filterUsers()" class="filter-select">
            <option value="all">All Roles</option>
            <option value="customer">Customers</option>
            <option value="seller">Sellers</option>
            <option value="admin">Admins</option>
          </select>
        </div>
      </div>

      <!-- Users Table -->
      <div class="users-table-container">
        <div class="loading" *ngIf="isLoading">
          <p>Loading users...</p>
        </div>
        
        <table class="users-table" *ngIf="!isLoading">
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Role</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers">
              <td>
                <div class="user-cell">
                  <div class="user-avatar">
                    <span>{{ user.displayName?.charAt(0) || 'U' }}</span>
                  </div>
                  <div class="user-details">
                    <h4>{{ user.displayName || 'Unknown User' }}</h4>
                    <p>{{ user.phoneNumber || 'No phone' }}</p>
                  </div>
                </div>
              </td>
              <td>{{ user.email }}</td>
              <td>
                <select 
                  [value]="user.role" 
                  (change)="updateUserRole(user.uid, $any($event.target).value)"
                  class="role-select"
                >
                  <option value="customer">Customer</option>
                  <option value="seller">Seller</option>
                  <option value="admin">Admin</option>
                </select>
              </td>
              <td>{{ formatDate(user.createdAt) }}</td>
              <td>
                <div class="action-buttons">
                  <button 
                    class="delete-btn" 
                    (click)="deleteUser(user.uid, user.email)"
                    [disabled]="user.role === 'admin'"
                  >
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <polyline points="3,6 5,6 21,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M19 6V20A2 2 0 0 1 17 22H7A2 2 0 0 1 5 20V6M8 6V4A2 2 0 0 1 10 2H14A2 2 0 0 1 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="no-users" *ngIf="!isLoading && filteredUsers.length === 0">
          <p>No users found matching your criteria.</p>
        </div>
      </div>
    </div>

    <!-- Database Overview Content -->
    <div class="admin-content" *ngIf="activeMenuItem === 'database'">
      <div class="database-grid">
        <div class="database-card" *ngFor="let collection of databaseCollections">
          <div class="db-icon">{{ collection.icon }}</div>
          <div class="db-content">
            <h3>{{ collection.count }}</h3>
            <p>{{ collection.name }}</p>
          </div>
        </div>
      </div>

      <div class="database-info">
        <h2>Database Collections</h2>
        <p>Overview of all collections in the Firebase Firestore database.</p>
        
        <div class="collection-list">
          <div class="collection-item" *ngFor="let collection of databaseCollections">
            <div class="collection-header">
              <span class="collection-icon">{{ collection.icon }}</span>
              <h4>{{ collection.name }}</h4>
            </div>
            <div class="collection-stats">
              <span class="count">{{ collection.count }} records</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
